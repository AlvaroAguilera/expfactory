---
layout: default
title: Generate your Experiment Container
pdf: true
permalink: /generate
toc: true
---

# Generate your Experiment Container
The generation of a container comes down to adding the experiments to a build file called a Singularity Recipe. In these sections, we will provide instructions for a [quick start](#quick-start) using a pre-generated container, and a more [detailed start](#detailed-start) where you can fine tune your experiments, database, and other details of your deployment.

### Quick Start
We provide an example container that you can deploy to test out Expfactory. It includes three experiments:

 - adaptive-n-back
 - test-task
 - tower-of-london

and is configured to use a "filesystem" database, meaning results are written to a folder that is mounted from the container on the host in `json`, organized by a study identifier. To get started quickly, we will do the following steps:

 1. install Singularity
 2. pull the experiment container
 3. start an instance
 4. use it!


First **install Singularity**. Instructions are provided on the [Singularity main site](https://singularityware.github.io/install-linux). Then **pull your container**. The container is build and provided for you on Singularity Hub. To pull the latest version:

```
singularity pull --name expfactory.simg shub://expfactory/expfactory
```

Next, you probably want to see how to [use your container](/expfactory/usage.html).


### Detailed Start

#### Write your recipe
A Singularity Recipe is a file that details how you want your container to build. In our case, we want to give instructions about which experiments to install. You can get a recipe in multiple ways!

1. Use the [example recipe provided](https://github.com/expfactory/expfactory/blob/master/Singularity)

```
wget https://raw.githubusercontent.com/expfactory/expfactory/master/Singularity
```

2. Use our [Recipe generator](https://www.github.com/expfactory/experiments/) to select experiments from the table, and generate a custom recipe. The table will also let you search and preview experiments in your browser.

3. Browse our [recipes generated by tag](https://www.github.com/expfactory/experiments/recipes) from the library.

You should have a build recipe `Singularity` in your present working directory. If you are using the example recipe, by default we will install three experiments, adaptive-n-back, test-task, and tower-of-london. If you want more information on browsing or customizing experiments, read about [customizing](1-generate-custom.md) experiments.

#### Database

**filesystem**
The default (simplest) method for a database is flat files, meaning that results are written to a mapped folder on the local machine, and each participant has their own results folder. This option is provided as many labs are accustomed to providing a battery locally, and want to save output directly to the filesystem without having any expertise with setting up a database.

**MySQL/Postgres/Mongo/Other**
For labs that wish to deploy the container on a server, you are encouraged to use a more substantial database. We haven't yet developed this, and if you are interested, please [file an issue](https://github.com/expfactory/expfactory).

In the future when you have the option to set up a custom database (other than filesystem) you will do so via a set of environment variables in the Singularity Recipe. Here is what the default looks like:

```
EXPFACTORY_DATA=/scif/data
EXPFACTORY_DATABASE=filesystem 
```

#### Configure your Battery
The Experiment Factory will generate a new unique ID for each participant with some study idenitifier prefix. The default is `expfactory`, meaning that my participants will be given identifiers `expfactory/0` through `expfactory/n`, and for a filesystem database, it will produce output files according to that schema:

```
 /scif/data/
      expfactory/
           00001/
            tower-of-london.json
            test-task.json
            adaptive-n-back.json
```

If you want to change the study identifier, just customize the variable under the `%environment` section:

```
%environment
    EXPFACTORY_STUDY_ID=expfactory
    export EXPFACTORY_STUDY_ID
```

In the future, our [online recipe generator](https://expfactory.github.io/experiments/generate) will make it easy to specify all of these variables. We will add these later after getting [feedback from users like you](https://www.github.com/expfactory/expfactory/issues). Let's move on the building your battery.

#### Define Custom Metadata
Your container will be programmatically accessible. This means that there are a set of labels about it's generation that will be produced automatically:

```
$ singularity inspect expfactory.simg
{
    "org.label-schema.usage.singularity.deffile.bootstrap": "docker",
    "org.label-schema.usage.singularity.deffile": "Singularity",
    "org.label-schema.usage": "/.singularity.d/runscript.help",
    "org.label-schema.schema-version": "1.0",
    "org.label-schema.usage.singularity.deffile.from": "ubuntu:14.04",
    "org.label-schema.build-date": "2017-11-06T20:42:28+00:00",
    "org.label-schema.usage.singularity.runscript.help": "/.singularity.d/runscript.help",
    "org.label-schema.usage.singularity.version": "2.4-feature-squashbuild-secbuild.g818b648",
    "org.label-schema.build-size": "545MB"
}
```

And additionally you can provide your own custom labels in a `%labels` section of your recipe to appear alongside the default set:

```
%labels
    Maintainer Vanessasaur
    Version 1.0.0
```

You can also add them specific to a particular experiment:

```
%applabels test-task
   variable value
```

We have plans to expose experiment-specific variables in this way, but @vsoch hasn't implemented it yet! Please send [feedback](https://www.github.com/expfactory/expfactory/issues) about your use case to help.

Next, you probably want to see how to [use your container](/expfactory/usage.html).

<div>
    <a href="/expfactory/"><button class="previous-button btn btn-primary"><i class="fa fa-chevron-left"></i> </button></a>
    <a href="/expfactory/usage.html"><button class="next-button btn btn-primary"><i class="fa fa-chevron-right"></i> </button></a>
</div><br>
